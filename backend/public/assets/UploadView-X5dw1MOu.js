import{_ as D,r as m,a as x,c as n,b as B,u as $,d as o,t as V,e as L,w as g,f as P,v as S,o as i,g as T,h as W,i as C,j as h,s as E,p as M,k as N}from"./index-MzDJ6x5p.js";import{B as R}from"./Back-znvs0cNT.js";const w=r=>(M("data-v-9bd99ed0"),r=r(),N(),r),z={class:"main"},A={class:"main-content"},F={key:0,class:"alert-msg warn"},q={class:"preview-container"},O=["src"],G={key:1,class:"preview-no-image"},H=w(()=>o("h2",null,"Upload a photo",-1)),J=w(()=>o("p",null,"Drag and drop your photo or just click this area",-1)),K=[H,J],Q={key:0,class:"btn-upload"},X={key:1},Y={__name:"UploadView",setup(r){const f=T(),v="https://jwt-fb-vue3-12dc3-default-rtdb.europe-west1.firebasedatabase.app",b="jwt-fb-vue3-12dc3.appspot.com",c=m(""),p=m(!1),_=m(null),s=x({photo:"",content:""});let t=null;async function k(){try{const e=`https://firebasestorage.googleapis.com/v0/b/${b}/o/posts%2F${t.name}`,a=await h.post(e,t,{headers:{"Content-Type":"image/png"}});return console.log("Img uploaded"),`${e}?alt=media&token=${a.data.downloadTokens}`}catch(e){console.log(e)}}async function y(){c.value="";let e=null;if(p.value=!0,t)if(t.size<9999999)e=await k();else{c.value="Max size is 10MB";return}const a=await W(),j={id:await C()+1,author:a||"Anonymous",caption:s.content,image:e||"",likes:0,timestamp:Date.now()};try{const l=await h.post(`${v}/posts.json`,j);console.log("Post published "),await h.patch(`${v}/posts/${l.data.name}.json`,{postName:l.data.name}),console.log("Post updated"),await E(l.data.name),f.push({name:"home"})}catch(l){console.log(l)}finally{p.value=!1}}function I(e){try{e.srcElement.files[0]&&(t=e.srcElement.files[0],(t.name.endsWith(".png")||t.name.endsWith(".jpg"))&&(s.photo=t,d()))}catch{console.log("Image was not found but we have")}}function d(){_.value=URL.createObjectURL(s.photo)}function U(e){t=e.dataTransfer.files[0],(t.name.endsWith(".png")||t.name.endsWith(".jpg"))&&(s.photo=t,d()),d()}return(e,a)=>(i(),n("div",z,[B(R,{onClick:a[0]||(a[0]=u=>$(f).back())}),o("div",A,[c.value?(i(),n("div",F,V(c.value),1)):L("",!0),o("form",{onSubmit:g(y,["prevent"]),class:"upload-form"},[o("label",{onDragover:a[1]||(a[1]=g(()=>{},["prevent"])),onDrop:g(U,["prevent"]),class:"drag-area",for:"input-photo"},[o("input",{onChange:I,type:"file",accept:"image/png, image/jpeg",id:"input-photo",hidden:""},null,32),o("div",q,[s.photo.name?(i(),n("img",{key:0,src:_.value,class:"preview-img"},null,8,O)):(i(),n("div",G,K))])],32),P(o("textarea",{class:"text-input","onUpdate:modelValue":a[2]||(a[2]=u=>s.content=u),placeholder:"Write a caption..",required:""},null,512),[[S,s.content]]),p.value?(i(),n("p",X,"Proccessing... Please wait")):(i(),n("button",Q,"Upload"))],32)])]))}},te=D(Y,[["__scopeId","data-v-9bd99ed0"]]);export{te as default};
